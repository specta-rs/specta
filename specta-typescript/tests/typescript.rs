// TODO

use specta::{Type, TypeCollection};
use specta_typescript::{Any, Typescript, Unknown};

#[derive(Type)]
struct Demo {
    a: Any<()>,
    b: Unknown<()>,
}

#[test]
fn typescript() {
    let types = TypeCollection::default().register::<Demo>();

    // TODO: Snapshot testing
    assert_eq!(
        Typescript::default().export(&types).map_err(|e| e.to_string()),
        Ok("// This file has been generated by Specta. Do not edit this file manually.\n\n\n\nexport type Demo = { \n\t\ta: any,\n\t\tb: unknown,\n\t};\n".into())
    );
}

// TODO: Unit test `export_to`'s fs operations

#[test]
fn reserved_field_names() {
    // Test that reserved JavaScript keywords are properly quoted when used as field names
    // Related issue: https://github.com/specta-rs/specta/issues/...
    #[derive(Type)]
    #[allow(non_snake_case)]
    struct ReservedFields {
        r#class: String,
        r#switch: i32,
        r#return: bool,
        r#if: u32,
        // Non-reserved TypeScript type names should work fine as field names
        string: String,
        number: i32,
    }

    let types = TypeCollection::default().register::<ReservedFields>();

    let result = Typescript::default().export(&types).unwrap();

    // Reserved keywords should be quoted
    assert!(
        result.contains(r#""class": string"#),
        "Field 'class' should be quoted"
    );
    assert!(
        result.contains(r#""switch": number"#),
        "Field 'switch' should be quoted"
    );
    assert!(
        result.contains(r#""return": boolean"#),
        "Field 'return' should be quoted"
    );
    assert!(
        result.contains(r#""if": number"#),
        "Field 'if' should be quoted"
    );

    // TypeScript type names are NOT reserved as field names, so should not be quoted
    assert!(
        result.contains("string: string"),
        "Field 'string' should not be quoted"
    );
    assert!(
        result.contains("number: number"),
        "Field 'number' should not be quoted"
    );
}

#[test]
fn reserved_variant_names() {
    // Test that reserved JavaScript keywords are properly quoted when used as variant names
    #[derive(Type)]
    #[allow(non_camel_case_types)]
    enum ReservedVariants {
        r#class { value: String },
        r#switch { count: i32 },
        NormalVariant,
    }

    let types = TypeCollection::default().register::<ReservedVariants>();

    let result = Typescript::default().export(&types).unwrap();

    // Reserved keywords should be quoted in variant names
    assert!(
        result.contains(r#""class""#),
        "Variant 'class' should be quoted"
    );
    assert!(
        result.contains(r#""switch""#),
        "Variant 'switch' should be quoted"
    );
}
